<h1>Manage Services</h1>
<p>Configure services that can use this authentication system.</p>

<% if (error) { %>
<div class="error-box"><%= error %></div>
<% } %>

<div class="container">
  <div class="form-container">
    <h2>Create New Service</h2>
    <form action="/admin/services" method="POST">
      <div class="form-group">
        <label for="serviceName">Service Name</label>
        <input
          type="text"
          id="serviceName"
          name="serviceName"
          value="<%= locals.input && input.serviceName ? input.serviceName : '' %>"
          required
        />
        <small>A unique name for the client application (e.g., "WebApp", "MobileApp").</small>
      </div>
      <div class="form-group">
        <label for="allowedOrigins">Allowed Origins (CORS)</label>
        <textarea id="allowedOrigins" name="allowedOrigins" rows="3">
          <%= locals.input && input.allowedOrigins ? input.allowedOrigins : '' %>
          </textarea>
        <small>Enter one full URL per line (e.g., http://localhost:3000). Leave empty if not a web client.</small>
      </div>
      <div class="form-group">
        <label for="max">Rate Limit</label>
        <div class="rate-limit-group">
          <input
            type="number"
            id="max"
            name="max"
            placeholder="Max Requests"
            value="<%= locals.input && input.max ? input.max : 100 %>"
            required
          />
          <span>requests per</span>
          <input
            type="number"
            id="windowMs"
            name="windowMs"
            placeholder="Window (ms)"
            value="<%= locals.input && input.windowMs ? input.windowMs : 900000 %>"
            required
          />
          <span>ms</span>
        </div>
        <small>Default: 100 requests per 900000ms (15 minutes).</small>
      </div>
      <button type="submit" class="btn-primary">Create Service</button>
    </form>
  </div>

  <div class="table-container">
    <h2>Existing Services</h2>
    <table>
      <thead>
        <tr>
          <th>Service Name</th>
          <th>Allowed Origins</th>
          <th>Rate Limit</th>
          <th>Created</th>
        </tr>
      </thead>
      <tbody>
        <% if (services.length > 0) { %> <% services.forEach(service => { %>
        <tr>
          <td><%= service.serviceName %></td>
          <td>
            <% if (service.allowedOrigins.length > 0) { %>
            <ul>
              <% service.allowedOrigins.forEach(origin => { %>
              <li><%= origin %></li>
              <% }) %>
            </ul>
            <% } else { %>
            <span>(none)</span>
            <% } %>
          </td>
          <td><%= service.rateLimit.max %> req / <%= service.rateLimit.windowMs / 1000 %>s</td>
          <td><%= new Date(service.createdAt).toLocaleDateString() %></td>
        </tr>
        <% }) %> <% } else { %>
        <tr>
          <td colspan="4" class="empty-state">No services configured yet.</td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>
